!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("tumblrSource",[],e):"object"==typeof exports?exports.tumblrSource=e():t.tumblrSource=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(i,o){try{var s=e[i](o),u=s.value}catch(a){return void n(a)}return s.done?void t(u):Promise.resolve(u).then(function(t){return r("next",t)},function(t){return r("throw",t)})}return r("next")})}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var a,c,f=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(1);Object.keys(l).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return l[t]}})});var p=n(2),h=r(p),d=n(3),v=r(d),y=!1,b={};Object.keys(console).forEach(function(t){"function"==typeof console[t]&&(b[t]=function(){if(y){var e=Array.from(arguments);return e.unshift("[TUMBLR SOURCE]"),console[t].apply(console,e)}})});var m=(c=a=function(t){function e(t){o(this,e);var n=s(this,Object.getPrototypeOf(e).call(this));return n.initialized=!1,n.stopFlag=!1,n.sync=!1,n.retryTimes=3,n.retriedTimes=0,n.lastError=null,n.STOP_FLAG_MESSAGE="Stop flag detected.",n.TIMEOUT_MESSAGE="Connection timed out.",n.STOP_CONDITION_MESSAGE="Stop condition reached.",n.UNDEFINED_RESPONSE_MESSAGE="Response is undefined.",n.EMPTY_RESPONSE_MESSAGE="Response was empty.",n.MAX_RETRIES_MESSAGE="Max retries reached, either there is a connection error or you have reached the maximum items you can fetch.",n.MAX_ITEMS_MESSAGE="Maximum fetchable items reached.","undefined"!=typeof t&&"undefined"!=typeof t.options&&(n.options=t.options,"undefined"!=typeof t.options.silent&&(n.silent=t.options.silent),"undefined"!=typeof t.options.verbose&&(n.silent=!t.options.verbose),Object.assign(n,(0,v["default"])(t,["condition","parse","step","sync"])),n._fetch="function"==typeof t.fetch&&t.fetch,n._save="function"==typeof t.save&&t.save,n._load="function"==typeof t.load&&t.load),n.debug=b,n.initialize(),n.on("continue",n.run.bind(n)),n.on("done",function(){n.stopFlag=!1}),n}return u(e,t),f(e,[{key:"initialize",value:function(){var t=this,e=function(){t.debug.log("done initializing."),t.emit("initialized"),t.initialized=!0};this.options&&(this.defaults=Object.assign({},this.options)),"undefined"==typeof this.condition&&(this.debug.warn("no condition set for "+this.options.item+", using default condition"),this.condition=function(){return!0}),"undefined"==typeof this.parse&&(this.debug.warn("no parse function defined, using default parse function"),this.parse=function(e){return t.debug.log(t.options),e[t.options.item]}),"undefined"==typeof this.step&&(this.debug.warn("no step set for "+this.options.item+", using default step function"),this.step=function(){return t.options.offset+=t.options.limit}),"undefined"!=typeof this._load?(this.debug.log("load function detected, restoring state..."),this.once("loaded",e),this.load()):e()}},{key:"load",value:function(){var t="function"==typeof this._load?this._load():void 0;if("undefined"!=typeof t){this.options={};for(var e in t)({}).hasOwnProperty.call(t,e)&&t[e]&&(this.options[e]=t[e])}this.loadedSaveState=!0,this.emit("loaded")}},{key:"save",value:function(){return this._save(this.options)}},{key:"start",value:function(t){return this.debug.log("starting ..."),this.stopFlag=!1,t&&(Object.assign(this.options,t),t.retryTimes&&(this.retryTimes=t.retryTimes),t.sync&&(this.sync=t.sync)),this.initialized?this.run():void this.once("loaded",this.run.bind(this))}},{key:"fetch",value:function(){function t(t){return e.apply(this,arguments)}var e=i(regeneratorRuntime.mark(function n(){var t,e=arguments.length<=0||void 0===arguments[0]?{offset:this.options[this.options.iterator],limit:this.options.limit}:arguments[0];return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this._fetch.call(this,e);case 3:return t=n.sent,n.abrupt("return",this.handleSuccess(t));case 7:return n.prev=7,n.t0=n["catch"](0),n.abrupt("return",this.handleError(n.t0));case 10:case"end":return n.stop()}},n,this,[[0,7]])}));return t}()},{key:"handleSuccess",value:function(t){return"function"==typeof this.parse?this.parse(t):t}},{key:"next",value:function(){return this.run()}},{key:"crawl",value:function(){function t(t,n){return e.apply(this,arguments)}var e=i(regeneratorRuntime.mark(function n(t,e){var r=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise(function(){var n=i(regeneratorRuntime.mark(function o(n,i){var s;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,e&&r.retriedTimes&&r.retriedTimes<=r.retryTimes&&r.debug.log("Retrying... Retried times: "+r.retriedTimes+", retrying from "+t.iterator+": "+r.options[t.iterator]+"..."),o.next=4,r.fetch();case 4:s=o.sent,"string"==typeof s?r.debug.log("✔ Crawled "+r.options.item+" from "+t.iterator+": "+r.options[t.iterator]):Array.isArray(s)&&r.debug.log("✔ Crawled "+s.length+" "+r.options.item+" from "+t.iterator+": "+r.options[t.iterator]),n(s),o.next=12;break;case 9:o.prev=9,o.t0=o["catch"](0),i(o.t0);case 12:case"end":return o.stop()}},o,r,[[0,9]])}));return function(t,e){return n.apply(this,arguments)}}()));case 1:case"end":return n.stop()}},n,this)}));return t}()},{key:"run",value:function(){function t(t){return e.apply(this,arguments)}var e=i(regeneratorRuntime.mark(function n(t){var e;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!this.stopFlag){n.next=3;break}return n.abrupt("return",this.done(this.STOP_FLAG_MESSAGE));case 3:if(this.condition()){n.next=5;break}return n.abrupt("return",this.done(this.STOP_CONDITION_MESSAGE));case 5:return this.debug.log("crawling..."),n.next=8,this.crawl({iterator:this.options.iterator,item:this.options.item},t);case 8:if(e=n.sent,this.retriedTimes=0,"function"==typeof this.step&&this.step(),this.emit("items",e),"undefined"!=typeof e){n.next=16;break}return n.abrupt("return",this.done(this.UNDEFINED_RESPONSE_MESSAGE));case 16:if(!Array.isArray(e)||0!==e.length){n.next=20;break}return n.abrupt("return",this.done(this.MAX_ITEMS_MESSAGE));case 20:if(0!==Object.keys(e).length||obj.constructor!==Object){n.next=22;break}return n.abrupt("return",this.done(this.EMPTY_RESPONSE_MESSAGE));case 22:n.next=29;break;case 24:if(n.prev=24,n.t0=n["catch"](0),!(this.retriedTimes<this.retryTimes)){n.next=28;break}return n.abrupt("return",this.handleError(n.t0));case 28:return n.abrupt("return",this.done(this.MAX_RETRIES_MESSAGE));case 29:if(!this.sync||this.stopFlag){n.next=33;break}return n.abrupt("return",this.run(t));case 33:if(!this.stopFlag){n.next=35;break}return n.abrupt("return",this.done(this.STOP_FLAG_MESSAGE));case 35:this.emit("next");case 36:case"end":return n.stop()}},n,this,[[0,24]])}));return t}()},{key:"stop",value:function(){this.emit("stop"),this.stopFlag=!0}},{key:"done",value:function(t){this.emit("done",t),this.removeListeners()}},{key:"handleError",value:function(t){var e=this;return this.debug.error(t),this.emit("error",t),this.lastError=t,t.toString().includes("malformed API response")?this.stop():this.retryTimes-this.retriedTimes===0?this.stop():(this.debug.log("Retry in 3s... will retry "+(this.retryTimes-this.retriedTimes)+" more time(s)"),void setTimeout(function(){return e.retriedTimes+=1,e.run(!0)},6e3))}},{key:"reset",value:function(){return this.initialize()}},{key:"removeListeners",value:function(){this.removeAllListeners()}},{key:"silent",set:function(t){y=!t},get:function(){return y}}]),e}(h["default"]),a.options={blog:null,offset:null,limit:null,page:null,iterator:null,item:"items",url:null,until:null},c);e["default"]=m},function(t,e){"use strict";function n(t,e){return function(n){return n.prototype[t]=function(){return e.apply(n.prototype,arguments)},n}}function r(t){return function(e){return Object.assign(e.prototype,{options:t}),e}}function i(){var t=arguments.length<=0||void 0===arguments[0]||arguments[0];return function(e){return Object.assign(e.prototype,{silent:t}),e}}function o(){var t=arguments.length<=0||void 0===arguments[0]||arguments[0];return function(e){return Object.assign(e.prototype,{silent:!t}),e}}function s(t,e,n){e=u.includes(e)?"_"+e:e,t.prototype[e]=function(){return n.apply(t.prototype,arguments)}}Object.defineProperty(e,"__esModule",{value:!0}),e.Options=r,e.Silent=i,e.Verbose=o,e.DecorateFn=s;var u=["fetch","load","save"];e.Condition=n.bind(void 0,"condition"),e.Fetch=n.bind(void 0,"_fetch"),e.Step=n.bind(void 0,"step"),e.Load=n.bind(void 0,"_load"),e.Save=n.bind(void 0,"_save"),e.Parse=n.bind(void 0,"parse")},function(t,e,n){"use strict";function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){}var o=Object.prototype.hasOwnProperty,s="function"!=typeof Object.create&&"~";i.prototype._events=void 0,i.prototype.eventNames=function(){var t,e=this._events,n=[];if(!e)return n;for(t in e)o.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},i.prototype.listeners=function(t,e){var n=s?s+t:t,r=this._events&&this._events[n];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,u=new Array(o);i<o;i++)u[i]=r[i].fn;return u},i.prototype.emit=function(t,e,n,r,i,o){var u=s?s+t:t;if(!this._events||!this._events[u])return!1;var a,c,f=this._events[u],l=arguments.length;if("function"==typeof f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,r),!0;case 5:return f.fn.call(f.context,e,n,r,i),!0;case 6:return f.fn.call(f.context,e,n,r,i,o),!0}for(c=1,a=new Array(l-1);c<l;c++)a[c-1]=arguments[c];f.fn.apply(f.context,a)}else{var p,h=f.length;for(c=0;c<h;c++)switch(f[c].once&&this.removeListener(t,f[c].fn,void 0,!0),l){case 1:f[c].fn.call(f[c].context);break;case 2:f[c].fn.call(f[c].context,e);break;case 3:f[c].fn.call(f[c].context,e,n);break;default:if(!a)for(p=1,a=new Array(l-1);p<l;p++)a[p-1]=arguments[p];f[c].fn.apply(f[c].context,a)}}return!0},i.prototype.on=function(t,e,n){var i=new r(e,n||this),o=s?s+t:t;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],i]:this._events[o].push(i):this._events[o]=i,this},i.prototype.once=function(t,e,n){var i=new r(e,n||this,(!0)),o=s?s+t:t;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],i]:this._events[o].push(i):this._events[o]=i,this},i.prototype.removeListener=function(t,e,n,r){var i=s?s+t:t;if(!this._events||!this._events[i])return this;var o=this._events[i],u=[];if(e)if(o.fn)(o.fn!==e||r&&!o.once||n&&o.context!==n)&&u.push(o);else for(var a=0,c=o.length;a<c;a++)(o[a].fn!==e||r&&!o[a].once||n&&o[a].context!==n)&&u.push(o[a]);return u.length?this._events[i]=1===u.length?u[0]:u:delete this._events[i],this},i.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[s?s+t:t]:this._events=s?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=s,t.exports=i},function(t,e){(function(e){function n(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function r(t,e){for(var n=-1,r=t?t.length:0,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function i(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function o(t,e,n,r,s){var u=-1,a=t.length;for(n||(n=c),s||(s=[]);++u<a;){var f=t[u];e>0&&n(f)?e>1?o(f,e-1,n,r,s):i(s,f):r||(s[s.length]=f)}return s}function s(t,e){return t=Object(t),u(t,e,function(e,n){return n in t})}function u(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var s=e[r],u=t[s];n(u,s)&&(o[s]=u)}return o}function a(t,e){return e=F(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=F(r.length-e,0),s=Array(o);++i<o;)s[i]=r[e+i];i=-1;for(var u=Array(e+1);++i<e;)u[i]=r[i];return u[e]=s,n(t,this,u)}}function c(t){return L(t)||l(t)||!!(G&&t&&t[G])}function f(t){if("string"==typeof t||m(t))return t;var e=t+"";return"0"==e&&1/t==-g?"-0":e}function l(t){return h(t)&&T.call(t,"callee")&&(!R.call(t,"callee")||M.call(t)==S)}function p(t){return null!=t&&v(t.length)&&!d(t)}function h(t){return b(t)&&p(t)}function d(t){var e=y(t)?M.call(t):"";return e==E||e==O}function v(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=_}function y(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function b(t){return!!t&&"object"==typeof t}function m(t){return"symbol"==typeof t||b(t)&&M.call(t)==x}var g=1/0,_=9007199254740991,S="[object Arguments]",E="[object Function]",O="[object GeneratorFunction]",x="[object Symbol]",j="object"==typeof e&&e&&e.Object===Object&&e,w="object"==typeof self&&self&&self.Object===Object&&self,A=j||w||Function("return this")(),k=Object.prototype,T=k.hasOwnProperty,M=k.toString,P=A.Symbol,R=k.propertyIsEnumerable,G=P?P.isConcatSpreadable:void 0,F=Math.max,L=Array.isArray,I=a(function(t,e){return null==t?{}:s(t,r(o(e,1),f))});t.exports=I}).call(e,function(){return this}())}])});
//# sourceMappingURL=tumblrSource.min.js.map